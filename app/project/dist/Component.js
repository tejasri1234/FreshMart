jQuery.sap.includeStyleSheet("css/style.css");sap.ui.define(["sap/ui/core/UIComponent","project/model/models","sap/ui/model/odata/v2/ODataModel"],(e,t,s)=>{"use strict";return e.extend("project.Component",{metadata:{manifest:"json",interfaces:["sap.ui.core.IAsyncContentCreation"]},init:function(){e.prototype.init.apply(this,arguments);this.setModel(t.createDeviceModel(),"device");var a=new sap.ui.model.json.JSONModel({items:[]});this.setModel(a,"cartModel");var o="/odata/v2/catalog/";var r=new s(o,{json:true});this.setModel(r);var i=new sap.ui.model.json.JSONModel({cartCount:0});this.setModel(i,"cartStatusModel");this.getRouter().initialize()},onProfilePress:function(e){var t=this.getModel("userModel");var s=t&&t.getProperty("/id");if(s){sap.m.MessageBox.confirm("You are logged in as "+t.getProperty("/name")+" ("+t.getProperty("/email")+").\n\nDo you want to log out?",{title:"Logout",icon:sap.m.MessageBox.Icon.QUESTION,actions:[sap.m.MessageBox.Action.YES,sap.m.MessageBox.Action.NO],emphasizedAction:sap.m.MessageBox.Action.YES,onClose:function(e){if(e===sap.m.MessageBox.Action.YES){this.setModel(null,"userModel");sap.m.MessageToast.show("Logged out successfully.")}}.bind(this)})}else{var a=e.byId("loginRegisterDialog");if(a){a.open()}else{sap.m.MessageBox.error("Login/Register dialog not found.")}}},onToggleForm:function(e){var t=e.byId("loginForm");var s=e.byId("registerForm");if(!t||!s){sap.m.MessageBox.error("Form controls not found.");return}var a=t.getVisible();t.setVisible(!a);s.setVisible(a)},loadOrdersForUser:function(){var e=this.getModel("userModel");var t=e&&e.getProperty("/id");if(!t){console.warn("User not logged in. Cannot load orders.");return}var s=this.getModel();s.read("/Order",{filters:[new sap.ui.model.Filter("customer_id",sap.ui.model.FilterOperator.EQ,t)],urlParameters:{$expand:"items($expand=product)"},success:function(e){console.log(e);const t=new sap.ui.model.json.JSONModel({orders:e.results});this.setModel(t,"ordersModel");this.getView().setModel(t,"ordersModel")}.bind(this),error:function(){sap.m.MessageToast.show("Failed to load orders.")}})},onRegister:function(e){var t=e.byId("fullName").getValue();var s=e.byId("registerEmail").getValue();var a=e.byId("mobileNumber").getValue();var o=e.byId("registerPassword").getValue();var r=e.byId("terms").getSelected();var i=e.byId("address").getValue();if(!t||!s||!a||!o||!i){sap.m.MessageBox.warning("Please fill in all required fields.");return}if(!r){sap.m.MessageBox.warning("You must agree to the Terms & Conditions.");return}this.getModel().read("/Customer",{filters:[new sap.ui.model.Filter("email",sap.ui.model.FilterOperator.EQ,s)],success:function(r){if(r.results&&r.results.length>0){sap.m.MessageBox.error("User already exists with this email.");return}var n={name:t,email:s,phone:a,password:o,address:i,createdAt:(new Date).toISOString()};this.getModel().create("/Customer",n,{success:function(){sap.m.MessageBox.success("Registration successful!");this.onToggleForm(e);var t=e.byId("loginRegisterDialog");if(t){t.close()}e.byId("fullName").setValue("");e.byId("registerEmail").setValue("");e.byId("mobileNumber").setValue("");e.byId("registerPassword").setValue("");e.byId("terms").setSelected(false);e.byId("address").setValue("");var a=new sap.ui.model.json.JSONModel({userId:s});this.setModel(a,"userModel")}.bind(this),error:function(){sap.m.MessageBox.error("Registration failed. Please try again.")}})}.bind(this),error:function(){sap.m.MessageBox.error("Could not check for existing user. Please try again.")}})},onForgotPasswordPress:function(){sap.m.MessageBox.information("Password reset functionality is not implemented in this demo.")},onToggleLoginPasswordVisibility:function(e){var t=e.byId("passwordInput");if(t){t.setType(t.getType()==="Password"?"Text":"Password")}},onToggleRegisterPasswordVisibility:function(e){var t=e.byId("registerPassword");if(t){t.setType(t.getType()==="Password"?"Text":"Password")}},onCloseLoginDialog:function(e){var t=e.byId("loginRegisterDialog");if(t){t.close()}},updateCartDisplay:function(e){var t=e.byId("cartItemsContainer");var s=e.byId("totalPriceText");var a=e.byId("placeOrderButton");t.removeAllItems();var o=this.getModel("cartModel");var r=o.getData();let i=0;if(!r.items||r.items.length===0){t.addItem(new sap.m.Text({text:"Your cart is empty. Browse products to add items!",textAlign:"Center"}).addStyleClass("cartEmptyText"));s.setText("");if(a){a.setVisible(false)}return}r.items.forEach((s,a)=>{i+=s.price*s.quantity;var n=new sap.m.HBox({items:[new sap.m.Button({icon:"sap-icon://less",type:"Transparent",press:()=>{if(s.quantity>1){s.quantity-=1}else{r.items.splice(a,1)}o.setProperty("/items",r.items);this.updateCartCount();this.updateCartDisplay(e)}}),new sap.m.Text({text:s.quantity.toString()}).addStyleClass("cartItemQuantity"),new sap.m.Button({icon:"sap-icon://add",type:"Transparent",press:()=>{if(s.quantity<s.stock){s.quantity+=1;this.updateCartCount();o.setProperty("/items",r.items);this.updateCartDisplay(e)}else{sap.m.MessageToast.show("Maximum stock reached for "+s.name+"!")}}})]}).addStyleClass("quantityControlBox");var d=new sap.m.HBox({items:[new sap.m.Text({text:s.name}).addStyleClass("cartItemName"),n]}).addStyleClass("cartItemBox");t.addItem(d)});s.setText("Total: â‚¹"+i.toFixed(2));if(a){a.setVisible(true)}},updateCartCount:function(){var e=this.getModel("cartModel").getProperty("/items")||[];var t=e.reduce((e,t)=>e+t.quantity,0);this.getModel("cartStatusModel").setProperty("/cartCount",t);sap.ui.getCore().getEventBus().publish("cart","updated")},onCartPress:function(e){var t=e.byId("cartPanel");t.setVisible(!t.getVisible());this.updateCartDisplay(e)},onCloseCart:function(e){var t=e.byId("cartPanel");if(t){t.setVisible(false)}},onAddToCart:function(e){var t=this.getModel("cartModel");var s=t.getProperty("/items")||[];if(typeof e.stock!=="number"){sap.m.MessageToast.show("Stock information not available for "+e.name+"!");return}var a=s.find(t=>t.id===e.id);if(a){if(a.quantity>=e.stock){sap.m.MessageToast.show("Maximum stock reached for "+e.name+"!");return}a.quantity+=1}else{if(e.stock<1){sap.m.MessageToast.show("Out of stock for "+e.name+"!");return}s.push({...e,quantity:1})}t.setProperty("/items",s);sap.m.MessageToast.show(e.name+" added to cart");this.updateCartCount();sap.ui.getCore().getEventBus().publish("cart","updated")},onPlaceOrder:function(e){var t=this.getModel("cartModel");var s=t.getData();var a=this.getModel("userModel");var o=e.getModel();var r=a&&a.getProperty("/id");if(!r){sap.m.MessageBox.error("You must be logged in to place an order.");return}if(!s.items||s.items.length===0){sap.m.MessageBox.warning("Your cart is empty.");return}var i=s.totalAmount;if(typeof i!=="number"){i=s.items.reduce((e,t)=>e+t.price*t.quantity,0)}var n=s.items.map(e=>({product_id:e.id,unit:e.quantity,price:e.price}));var d={customer_id:r,orderDate:(new Date).toISOString(),status:"Placed",totalAmount:i,items:n};o.create("/Order",d,{success:function(){s.items.forEach(e=>{var t=e.stock-e.quantity;if(t<0)t=0;o.update("/Product('"+e.id+"')",{stock:t},{success:function(){},error:function(){sap.m.MessageToast.show("Failed to update stock for "+e.name)}})});sap.m.MessageBox.success("Order placed successfully! Your order will be delivered in 10 minutes.",{title:"Order Successful"});this.loadOrdersForUser();t.setProperty("/items",[]);t.setProperty("/totalAmount",0);this.onCloseCart(e);this.updateCartDisplay(e)}.bind(this),error:function(){sap.m.MessageBox.error("Order placement failed. Please try again.")}})}})});
//# sourceMappingURL=Component.js.map