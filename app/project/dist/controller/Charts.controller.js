sap.ui.define(["sap/ui/core/mvc/Controller","sap/viz/ui5/data/FlattenedDataset","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/model/json/JSONModel"],function(e,t,s,a){"use strict";return e.extend("project.controller.Charts",{onInit:function(){const e=this.getView().byId("idPieChart");const o=this.getOwnerComponent().getModel();this.getView().setModel(o);e.setVizProperties({title:{text:"Sales by Category",visible:true}});o.read("/MostSoldCategories",{success:o=>{const r=o.results.map(e=>({Category:e.category,Units:e.totalUnits}));const n=new a(r);e.setModel(n);const d=new t({dimensions:[{name:"Category",value:"{Category}"}],measures:[{name:"Units",value:"{Units}"}],data:{path:"/"}});e.setDataset(d);e.addFeed(new s({uid:"size",type:"Measure",values:["Units"]}));e.addFeed(new s({uid:"color",type:"Dimension",values:["Category"]}));e.attachSelectData(this.onCategorySelected.bind(this))},error:e=>{console.error("OData read failed:",e);sap.m.MessageToast.show("Failed to load chart data.")}})},onCategorySelected:function(e){const t=e.getParameter("data")[0].data.Category;const s=this.getOwnerComponent().getModel();s.read("/Product",{filters:[new sap.ui.model.Filter("category/name","EQ",t)],success:e=>{const a=e.results;s.read("/OrderItem",{urlParameters:{$expand:"product($expand=category)"},success:e=>{const s=e.results.filter(e=>e.product?.category?.name===t);const o={};s.forEach(e=>{const t=e.product.name;o[t]=(o[t]||0)+e.unit});const r=a.map(e=>({Product:e.name,Units:o[e.name]||0}));const n=new sap.ui.model.json.JSONModel(r);const d=this.getView().byId("idBarChart");d.setModel(n);const i=new sap.viz.ui5.data.FlattenedDataset({dimensions:[{name:"Product",value:"{Product}"}],measures:[{name:"Units",value:"{Units}"}],data:{path:"/"}});d.setDataset(i);d.removeAllFeeds();d.addFeed(new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"valueAxis",type:"Measure",values:["Units"]}));d.addFeed(new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"categoryAxis",type:"Dimension",values:["Product"]}));d.setVizType("column");d.setVizProperties({title:{text:`Top Selling Products in ${t}`,visible:true}})},error:e=>{console.error("Failed to load OrderItems:",e);sap.m.MessageToast.show("Failed to load product sales data.")}})},error:e=>{console.error("Failed to load products:",e);sap.m.MessageToast.show("Failed to load product list.")}})}})});
//# sourceMappingURL=Charts.controller.js.map